<link rel="import" href="../../polymer/polymer-element.html" />
<link rel="import" href="theme.html" />

<dom-module id="hakuneko-status">
  <template>
    <style include="theme"></style>
    <style>
      :host {
        display: flex;
        flex-direction: row;
        height: 2rem;
        align-items: center;
        background: var(--base);
        color: var(--text);
      }
      .status {
        flex: 0;
      }
      .status__message {
        flex: 1;
        margin-left: 0.5rem;
      }
      .status__icon {
        width: 2rem;
        height: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .popup {
        padding: 0.5em;
        background-color: #ffffff;
      }
      .show {
        display: block;
      }
      .hide {
        display: none;
      }
    </style>
    <div class="status__message">[[ message ]]</div>
    <div
      class$="status [[ getStatusClass(queue.length) ]]"
      title$="[[ getQueueContent(queue.length) ]]"
    >
      [[ queue.legth ]]
      <i class="status__icon mdi mdi-loading mdi-24px mdi-spin"></i>
    </div>
  </template>

  <script>
    /** @polymerElement */
    class HakunekoStatus extends Polymer.Element {
      /**
       *
       */
      static get is() {
        return "hakuneko-status";
      }

      /**
       *
       */
      static get properties() {
        return {
          message: {
            type: String,
            value: "",
            notify: true, // enable upward data flow,
            //readOnly: true, // prevent downward data flow
            //observer: 'onSelectedMangaChanged'
          },
        };
      }

      /**
       *
       */
      ready() {
        super.ready();
        this.queue = [];
      }

      /**
       *
       */
      getStatusClass(trigger) {
        return this.queue.length > 0 ? "show" : "hide";
      }

      /**
       *
       */
      getQueueContent(trigger) {
        return this.queue
          .map(function (item) {
            return item.text;
          })
          .join("\n");
      }

      /**
       *
       */
      addToQueue(text) {
        let id = Symbol(text);
        this.push("queue", { id: id, text: text });
        return id;
      }

      /**
       *
       */
      removeFromQueue(id) {
        let index = this.queue.findIndex((item) => {
          return id === item.id;
        });
        if (index > -1) {
          this.splice("queue", index, 1);
        }
      }
    }
    window.customElements.define(HakunekoStatus.is, HakunekoStatus);
  </script>
</dom-module>
